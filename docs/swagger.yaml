basePath: /api
definitions:
  model.BrevoEmailRequest:
    properties:
      htmlContent:
        type: string
      sender:
        $ref: '#/definitions/model.Recipient'
      subject:
        type: string
      to:
        items:
          $ref: '#/definitions/model.Recipient'
        type: array
    type: object
  model.Margin:
    properties:
      margin:
        type: number
      name:
        type: string
      symbol:
        type: string
    type: object
  model.MessageResponse:
    description: Standard response containing status and a descriptive message
    properties:
      message:
        description: Message provides details about the operation result
        example: Otp sent successfully to user@example.com
        type: string
      otpSent:
        description: OtpSent indicates if the OTP was successfully triggered
        example: true
        type: boolean
    type: object
  model.NSEHistoricalData:
    properties:
      chClosingPrice:
        type: number
      chOpeningPrice:
        type: number
      chSymbol:
        type: string
      chTradeHighPrice:
        type: number
      chTradeLowPrice:
        type: number
      mtimestamp:
        type: string
    type: object
  model.Recipient:
    properties:
      email:
        type: string
      name:
        type: string
    type: object
  model.Response:
    properties:
      data: {}
      error:
        type: string
      message:
        example: Update successful
        type: string
      success:
        example: true
        type: boolean
    type: object
  model.SectorData:
    properties:
      close:
        type: number
      current:
        type: number
      high:
        type: number
      index:
        type: string
      indexLongName:
        type: string
      low:
        type: number
      open:
        type: number
      pChange:
        type: number
      timeStamp:
        type: string
    type: object
  model.StockData:
    properties:
      close:
        type: number
      name:
        type: string
      nsecode:
        type: string
    type: object
  model.StockMarginDto:
    properties:
      close:
        type: number
      margin:
        type: number
      name:
        type: string
      symbol:
        type: string
    type: object
  model.Strategy:
    properties:
      active:
        type: boolean
      name:
        type: string
      scanClause:
        type: string
    type: object
  model.StrategyDto:
    properties:
      active:
        type: boolean
      name:
        type: string
      scanClause:
        type: string
    required:
    - name
    - scanClause
    type: object
  model.UpdateThemeRequest:
    properties:
      theme:
        allOf:
        - $ref: '#/definitions/model.UserTheme'
        enum:
        - LIGHT
        - DARK
        example: DARK
    required:
    - theme
    type: object
  model.UserDto:
    properties:
      confirmPassword:
        type: string
      email:
        type: string
      password:
        type: string
      role:
        $ref: '#/definitions/model.UserRole'
      theme:
        $ref: '#/definitions/model.UserTheme'
      username:
        type: string
    required:
    - confirmPassword
    - email
    type: object
  model.UserRole:
    description: ADMIN or USER access level
    enum:
    - ADMIN
    - USER
    type: string
    x-enum-varnames:
    - RoleAdmin
    - RoleUser
  model.UserTheme:
    description: LIGHT or DARK theme mode
    enum:
    - LIGHT
    - DARK
    type: string
    x-enum-varnames:
    - ThemeLight
    - ThemeDark
  model.VerifyOtpRequest:
    properties:
      email:
        example: user@example.com
        type: string
      otp:
        example: "123456"
        type: string
    required:
    - email
    - otp
    type: object
info:
  contact: {}
  description: This is a specialized server for managing trading strategies and margins.
  title: Trades Management API
  version: "1.0"
paths:
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticates user and returns user details without password
      parameters:
      - description: Login Credentials (only email/password required)
        in: body
        name: login
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful (Passwords omitted)
          schema:
            $ref: '#/definitions/model.UserDto'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User Login
      tags:
      - Auth
  /auth/logout:
    post:
      description: Clears the authentication cookie to log out the user
      produces:
      - application/json
      responses:
        "200":
          description: 'message: Logged out successfully'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Logout user
      tags:
      - Auth
  /auth/me:
    get:
      description: Retrieves user details (email and role) from the session cookie
      produces:
      - application/json
      responses:
        "200":
          description: User details successfully retrieved
          schema:
            $ref: '#/definitions/model.UserDto'
        "401":
          description: 'Unauthorized: Session invalid or expired'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get current authenticated user
      tags:
      - Auth
  /auth/signup:
    post:
      consumes:
      - application/json
      description: Stores user data in local memory for 5 minutes and sends an OTP.
      parameters:
      - description: User Registration Details
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.MessageResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User Signup
      tags:
      - auth
  /auth/verify-otp:
    post:
      consumes:
      - application/json
      description: Validates the OTP from cache. If valid, creates the user in the
        database and returns a JWT.
      parameters:
      - description: OTP Verification Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.VerifyOtpRequest'
      produces:
      - application/json
      responses:
        "201":
          description: User created successfully
          schema:
            $ref: '#/definitions/model.MessageResponse'
        "400":
          description: Invalid OTP or session expired
          schema:
            $ref: '#/definitions/model.MessageResponse'
      summary: Verify OTP and Create User
      tags:
      - auth
  /chartink/fetch:
    get:
      description: Triggers a scan on ChartInk for the given strategy and returns
        raw stock data
      parameters:
      - description: Name of the strategy to run
        example: Bullish_Engulfing
        in: query
        name: strategy
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StockData'
            type: array
        "404":
          description: Strategy not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Fetch raw ChartInk data
      tags:
      - ChartInk
  /chartink/fetchWithMargin:
    get:
      description: Triggers a scan and maps the results with the current margin and
        leverage data
      parameters:
      - description: Name of the strategy to run
        example: Nifty_50_Breakout
        in: query
        name: strategy
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StockMarginDto'
            type: array
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Fetch ChartInk data with Margin info
      tags:
      - ChartInk
  /email/send:
    post:
      consumes:
      - application/json
      description: Sends a transactional email using the Brevo API provider
      parameters:
      - description: Email content and recipients
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.BrevoEmailRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: string
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Failed to send email
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Send an email
      tags:
      - Email
  /health:
    get:
      description: Confirm that the server is up and running. Returns a 200 status
        code with no body.
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: System Health Check
      tags:
      - System
    head:
      description: Confirm that the server is up and running. Returns a 200 status
        code with no body.
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: System Health Check
      tags:
      - System
  /margin/{symbol}:
    get:
      description: Fetches the margin details for a specific stock symbol
      parameters:
      - description: Stock Symbol
        example: RELIANCE
        in: path
        name: symbol
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Margin'
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get margin by symbol
      tags:
      - Margin
  /margin/all:
    get:
      description: Returns a list of all stock margins stored in the database
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.Margin'
            type: array
      summary: Get all margins
      tags:
      - Margin
  /margin/load-from-csv:
    post:
      consumes:
      - multipart/form-data
      description: Uploads a CSV file to bulk load or update margin data
      parameters:
      - description: Margin CSV file
        in: formData
        name: file
        required: true
        type: file
      responses:
        "200":
          description: OK
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Upload Margin CSV
      tags:
      - Margin
  /margin/reload:
    get:
      description: Forces a reload of all margins from the persistent database into
        the memory cache
      responses:
        "200":
          description: OK
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Reload margins
      tags:
      - Margin
  /nse/heatmap:
    get:
      consumes:
      - application/json
      description: Fetches the latest sectoral index performance data. Uses a warmup
        time-cache strategy to serve data efficiently and avoid NSE rate limits.
      produces:
      - application/json
      responses:
        "200":
          description: Fetch Success
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/model.SectorData'
                  type: array
              type: object
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get NSE Sectoral Heatmap
      tags:
      - Stocks
  /nse/history:
    get:
      consumes:
      - application/json
      description: Fetches stock history for a specific symbol (e.g., BEL). Data is
        cached for 1 hour.
      parameters:
      - description: Stock Symbol (e.g. BEL)
        in: query
        name: symbol
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Fetch Success
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/model.NSEHistoricalData'
                  type: array
              type: object
        "400":
          description: Invalid Request
          schema:
            $ref: '#/definitions/model.Response'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get Historical Stock Data
      tags:
      - Stocks
  /strategy:
    delete:
      description: Removes a strategy from the system using its ID (Name)
      parameters:
      - description: Strategy ID (Name)
        in: query
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Delete a strategy
      tags:
      - Strategy
    get:
      description: Returns a list of all configured trading strategies
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StrategyDto'
            type: array
      summary: Get all strategies
      tags:
      - Strategy
    post:
      consumes:
      - application/json
      description: Saves a new trading strategy configuration to the database
      parameters:
      - description: Strategy Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.StrategyDto'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/model.Strategy'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Create a strategy
      tags:
      - Strategy
    put:
      consumes:
      - application/json
      description: Updates the configuration of an existing strategy by name
      parameters:
      - description: Updated Strategy Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.StrategyDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Strategy'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Update a strategy
      tags:
      - Strategy
  /strategy/admin:
    get:
      description: Returns a list of all configured trading strategies
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StrategyDto'
            type: array
      summary: Get all strategies
      tags:
      - Strategy
  /strategy/reload:
    post:
      description: Syncs the in-memory strategy cache with the MongoDB database
      responses:
        "200":
          description: OK
      summary: Reload strategies
      tags:
      - Strategy
  /user/theme:
    patch:
      consumes:
      - application/json
      description: Updates the theme preference (LIGHT/DARK) for the authenticated
        user
      parameters:
      - description: Theme Preference
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.UpdateThemeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update User Theme
      tags:
      - user
  /user/username:
    patch:
      consumes:
      - application/json
      description: Updates the username and returns the updated user object
      parameters:
      - description: Target Email and New Username
        in: body
        name: update
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update Username
      tags:
      - User
swagger: "2.0"
