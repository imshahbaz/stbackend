basePath: /api
definitions:
  model.AllIndicesResponse:
    properties:
      index:
        type: string
      indexSymbol:
        type: string
      key:
        type: string
      last:
        type: number
      oneWeekAgoVal:
        type: number
      perChange1w:
        type: number
      perChange30d:
        type: number
      perChange365d:
        type: number
      percentChange:
        type: number
    type: object
  model.BrevoEmailRequest:
    properties:
      htmlContent:
        type: string
      sender:
        $ref: '#/definitions/model.Recipient'
      subject:
        type: string
      to:
        items:
          $ref: '#/definitions/model.Recipient'
        type: array
    type: object
  model.ChartInkResponseDto:
    properties:
      data:
        description: json:"data" tells the parser to map the JSON key "data" to this
          field
        items:
          $ref: '#/definitions/model.StockData'
        type: array
    type: object
  model.Margin:
    properties:
      margin:
        type: number
      name:
        type: string
      symbol:
        type: string
    type: object
  model.MessageResponse:
    description: Standard response containing status and a descriptive message
    properties:
      message:
        description: Message provides details about the operation result
        example: Otp sent successfully to user@example.com
        type: string
      otpSent:
        description: OtpSent indicates if the OTP was successfully triggered
        example: true
        type: boolean
    type: object
  model.MongoEnvConfig:
    properties:
      apiKey:
        type: string
      brevoApiKey:
        type: string
      brevoEmail:
        type: string
      debug:
        type: boolean
      frontendUrls:
        items:
          type: string
        type: array
      jwtSecret:
        type: string
      leverage:
        type: number
      rateLimiter:
        type: boolean
    type: object
  model.NSEHistoricalData:
    properties:
      chClosingPrice:
        type: number
      chOpeningPrice:
        type: number
      chSymbol:
        type: string
      chTradeHighPrice:
        type: number
      chTradeLowPrice:
        type: number
      mtimestamp:
        type: string
    type: object
  model.ObRequest:
    properties:
      date:
        type: string
      high:
        type: number
      low:
        type: number
      symbol:
        type: string
    type: object
  model.Recipient:
    properties:
      email:
        type: string
      name:
        type: string
    type: object
  model.Response:
    properties:
      data: {}
      error:
        type: string
      message:
        example: Update successful
        type: string
      success:
        example: true
        type: boolean
    type: object
  model.SectorData:
    properties:
      close:
        type: number
      current:
        type: number
      high:
        type: number
      index:
        type: string
      indexLongName:
        type: string
      low:
        type: number
      open:
        type: number
      pChange:
        type: number
      timeStamp:
        type: string
    type: object
  model.StockData:
    properties:
      close:
        type: number
      name:
        type: string
      nsecode:
        type: string
    type: object
  model.StockMarginDto:
    properties:
      close:
        type: number
      margin:
        type: number
      name:
        type: string
      symbol:
        type: string
    type: object
  model.Strategy:
    properties:
      active:
        type: boolean
      name:
        type: string
      scanClause:
        type: string
    type: object
  model.StrategyDto:
    properties:
      active:
        type: boolean
      name:
        type: string
      scanClause:
        type: string
    required:
    - name
    - scanClause
    type: object
  model.TruecallerDto:
    properties:
      accessToken:
        type: string
      endpoint:
        type: string
      requestId:
        type: string
    type: object
  model.UpdateThemeRequest:
    properties:
      theme:
        allOf:
        - $ref: '#/definitions/model.UserTheme'
        enum:
        - LIGHT
        - DARK
        example: DARK
    required:
    - theme
    type: object
  model.UserDto:
    properties:
      confirmPassword:
        type: string
      email:
        type: string
      mobile:
        type: integer
      password:
        type: string
      role:
        $ref: '#/definitions/model.UserRole'
      theme:
        $ref: '#/definitions/model.UserTheme'
      username:
        type: string
    required:
    - confirmPassword
    - email
    type: object
  model.UserRole:
    description: ADMIN or USER access level
    enum:
    - ADMIN
    - USER
    type: string
    x-enum-varnames:
    - RoleAdmin
    - RoleUser
  model.UserTheme:
    description: LIGHT or DARK theme mode
    enum:
    - LIGHT
    - DARK
    type: string
    x-enum-varnames:
    - ThemeLight
    - ThemeDark
  model.VerifyOtpRequest:
    properties:
      email:
        example: user@example.com
        type: string
      otp:
        example: "123456"
        type: string
    required:
    - email
    - otp
    type: object
info:
  contact: {}
  description: This is a specialized server for managing trading strategies and margins.
  title: Trades Management API
  version: "1.0"
paths:
  /api/auth/status/{requestId}:
    get:
      description: Polls for the status of a login request. If successful, creates
        the user, generates a JWT, and sets an auth cookie.
      parameters:
      - description: Unique Request ID
        in: path
        name: requestId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "201":
          description: User created and JWT issued
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  $ref: '#/definitions/model.UserDto'
                message:
                  type: string
                success:
                  type: boolean
              type: object
        "404":
          description: Waiting for Truecaller callback
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                error:
                  type: string
                success:
                  type: boolean
              type: object
        "500":
          description: Failed to create user or generate token
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                message:
                  type: string
                success:
                  type: boolean
              type: object
      summary: Check Truecaller Auth Status
      tags:
      - Authentication
  /api/auth/truecaller:
    post:
      consumes:
      - application/json
      description: Receives the access token from Truecaller, fetches user profile,
        and warms up the local cache for NSE data.
      parameters:
      - description: Truecaller Data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/model.TruecallerDto'
      produces:
      - application/json
      responses:
        "200":
          description: Callback Successful
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                error:
                  type: string
                success:
                  type: boolean
              type: object
        "400":
          description: Invalid Request
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                error:
                  type: string
                success:
                  type: boolean
              type: object
        "500":
          description: Internal Server Error
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                error:
                  type: string
                success:
                  type: boolean
              type: object
      summary: Process Truecaller Login Callback
      tags:
      - Authentication
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticates user via HttpOnly cookie and JWT
      parameters:
      - description: Login Credentials
        in: body
        name: login
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.UserDto'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User Login
      tags:
      - Auth
  /auth/logout:
    post:
      description: Clears the authentication cookie
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User Logout
      tags:
      - Auth
  /auth/me:
    get:
      description: Retrieves authenticated user details from session
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.UserDto'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get Current User
      tags:
      - Auth
  /auth/signup:
    post:
      consumes:
      - application/json
      description: Caches user data and sends OTP for verification
      parameters:
      - description: Signup Details
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.MessageResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/model.MessageResponse'
      summary: User Signup Initiation
      tags:
      - Auth
  /auth/verify-otp:
    post:
      consumes:
      - application/json
      description: Validates OTP and persists user to database
      parameters:
      - description: OTP Verification
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.VerifyOtpRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/model.MessageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.MessageResponse'
      summary: Verify OTP and Complete Signup
      tags:
      - Auth
  /chartink/fetch:
    get:
      description: Triggers a scan on ChartInk for the given strategy and returns
        raw stock data
      parameters:
      - description: Name of the strategy to run
        example: Bullish_Engulfing
        in: query
        name: strategy
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.ChartInkResponseDto'
        "400":
          description: Strategy name required
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Strategy not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Fetch raw ChartInk data
      tags:
      - ChartInk
  /chartink/fetchWithMargin:
    get:
      description: Triggers a scan and maps results with current margin and leverage
        data
      parameters:
      - description: Name of the strategy to run
        example: Nifty_50_Breakout
        in: query
        name: strategy
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StockMarginDto'
            type: array
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Fetch ChartInk data with Margin info
      tags:
      - ChartInk
  /config/active:
    get:
      description: Returns current system settings (Leverage, API Keys, etc.) from
        memory.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.MongoEnvConfig'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get Active Configuration
      tags:
      - Config
  /config/reload:
    post:
      description: Triggers a fresh fetch from MongoDB to update the in-memory cache.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Reload System Configuration
      tags:
      - Config
  /config/update:
    patch:
      consumes:
      - application/json
      description: Updates MongoDB and hot-swaps active memory config.
      parameters:
      - description: Update Config Fields
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.MongoEnvConfig'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update System Configuration
      tags:
      - Config
  /email/send:
    post:
      consumes:
      - application/json
      description: Sends a transactional email using the Brevo API provider
      parameters:
      - description: Email content and recipients
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.BrevoEmailRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Email sent successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Failed to send email
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Send an email
      tags:
      - Email
  /health:
    get:
      description: Confirm that the server is up and running. Used by Load Balancers
        and Uptime Monitors.
      produces:
      - application/json
      responses:
        "200":
          description: Status OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: System Health Check
      tags:
      - System
    head:
      description: Confirm that the server is up and running. Used by Load Balancers
        and Uptime Monitors.
      produces:
      - application/json
      responses:
        "200":
          description: Status OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: System Health Check
      tags:
      - System
  /margin/all:
    get:
      description: Returns a list of all stock margins from the local memory cache
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.Margin'
            type: array
      summary: Get all margins
      tags:
      - Margin
  /margin/load-from-csv:
    post:
      consumes:
      - multipart/form-data
      description: Uploads a CSV file to bulk load or update margin data
      parameters:
      - description: Margin CSV file
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Upload Margin CSV
      tags:
      - Margin
  /margin/reload:
    post:
      description: Forces a reload of all margins from MongoDB into the memory cache
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Reload margins
      tags:
      - Margin
  /margin/symbol/{symbol}:
    get:
      description: Fetches the margin details for a specific stock symbol
      parameters:
      - description: Stock Symbol
        example: RELIANCE
        in: path
        name: symbol
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Margin'
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get margin by symbol
      tags:
      - Margin
  /nse/allindices:
    get:
      description: Fetches latest performance data for all indices using the warmup
        strategy.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/model.AllIndicesResponse'
                  type: array
              type: object
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get All NSE Indices
      tags:
      - Stocks
  /nse/heatmap:
    get:
      description: Fetches latest sectoral data. Uses warmup time-cache strategy to
        avoid NSE rate limits.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/model.SectorData'
                  type: array
              type: object
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get NSE Sectoral Heatmap
      tags:
      - Stocks
  /nse/history:
    get:
      consumes:
      - application/json
      description: Fetches stock history for a specific symbol. Utilizes a 1-hour
        time cache.
      parameters:
      - description: Stock Symbol (e.g. RELIANCE)
        in: query
        name: symbol
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/model.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/model.NSEHistoricalData'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get Historical Stock Data
      tags:
      - Stocks
  /price-action/{symbol}:
    get:
      parameters:
      - description: Symbol
        in: path
        name: symbol
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Get PA by Symbol
      tags:
      - PriceAction
  /price-action/automate:
    post:
      responses:
        "202":
          description: Accepted
          schema:
            $ref: '#/definitions/model.Response'
      summary: Trigger PA Automation
      tags:
      - PriceAction
  /price-action/fvg:
    delete:
      parameters:
      - description: Delete Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Delete FVG
      tags:
      - PriceAction (Admin)
    patch:
      parameters:
      - description: Update Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update FVG
      tags:
      - PriceAction (Admin)
    post:
      parameters:
      - description: FVG Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Save FVG
      tags:
      - PriceAction (Admin)
  /price-action/fvg/check:
    post:
      description: Triggers a fresh scan of all stocks against saved Fair Value Gaps
        (FVG) to identify active mitigations. This bypasses the cache and updates
        it.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Force Refresh FVG Mitigations
      tags:
      - PriceAction
  /price-action/fvg/cleanup:
    post:
      description: Triggers a maintenance task that fetches NSE history for all stored
        symbols and deletes FVGs that have been breached or filled by subsequent price
        action.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Clean up filled FVGs
      tags:
      - PriceAction
  /price-action/fvg/mitigation:
    get:
      responses: {}
      summary: Get Cached FVG Mitigations
      tags:
      - PriceAction
  /price-action/fvg/old/{stopDate}:
    post:
      consumes:
      - multipart/form-data
      description: Upload a CSV to find and save FVGs from a specific stop date backwards.
      parameters:
      - description: CSV File
        in: formData
        name: file
        required: true
        type: file
      - description: Stop Date (YYYY-MM-DD)
        in: path
        name: stopDate
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Process Historical Fair Value Gaps (FVG)
      tags:
      - PriceAction
  /price-action/ob:
    delete:
      parameters:
      - description: Delete Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Delete OB
      tags:
      - PriceAction (Admin)
    patch:
      parameters:
      - description: Update Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update OB
      tags:
      - PriceAction (Admin)
    post:
      parameters:
      - description: OB Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.ObRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
      summary: Save OB
      tags:
      - PriceAction (Admin)
  /price-action/ob/check:
    post:
      description: Triggers a fresh scan of all stocks against saved Order Blocks
        to find active mitigations.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/model.Response'
      summary: Force Refresh OB Mitigations
      tags:
      - PriceAction
  /price-action/ob/mitigation:
    get:
      responses: {}
      summary: Get Cached OB Mitigations
      tags:
      - PriceAction
  /price-action/ob/old/{stopDate}:
    post:
      consumes:
      - multipart/form-data
      description: Upload a CSV to find and save Order Blocks from a specific stop
        date backwards.
      parameters:
      - description: CSV File
        in: formData
        name: file
        required: true
        type: file
      - description: Stop Date (YYYY-MM-DD)
        in: path
        name: stopDate
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Process Historical Order Blocks
      tags:
      - PriceAction
  /strategy:
    delete:
      description: Removes a strategy from the system using its ID/Name
      parameters:
      - description: Strategy ID (Name)
        in: query
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
      summary: Delete a strategy
      tags:
      - Strategy
    get:
      description: Returns a list of all configured active trading strategies
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StrategyDto'
            type: array
      summary: Get all strategies
      tags:
      - Strategy
    post:
      consumes:
      - application/json
      description: Saves a new trading strategy configuration to MongoDB
      parameters:
      - description: Strategy Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.StrategyDto'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/model.Strategy'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Create a strategy
      tags:
      - Strategy
    put:
      consumes:
      - application/json
      description: Updates an existing strategy configuration by name/ID
      parameters:
      - description: Updated Details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.StrategyDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Strategy'
      summary: Update a strategy
      tags:
      - Strategy
  /strategy/admin:
    get:
      description: Returns all trading strategies with full administrative details
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/model.StrategyDto'
            type: array
      summary: Get all strategies (Admin)
      tags:
      - Strategy
  /strategy/reload:
    post:
      description: Syncs the in-memory strategy cache with MongoDB
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Reload strategies
      tags:
      - Strategy
  /user/theme:
    patch:
      consumes:
      - application/json
      description: Updates preference (LIGHT/DARK) for the authenticated user
      parameters:
      - description: Theme Preference
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/model.UpdateThemeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update User Theme
      tags:
      - User
  /user/username:
    patch:
      consumes:
      - application/json
      description: Updates the username and invalidates the auth cache
      parameters:
      - description: Target Email and New Username
        in: body
        name: update
        required: true
        schema:
          $ref: '#/definitions/model.UserDto'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/model.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/model.Response'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/model.Response'
      summary: Update Username
      tags:
      - User
swagger: "2.0"
